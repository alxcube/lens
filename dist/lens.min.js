!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.lens=e():t.lens=e()}(this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"ReversePixelMapping",(function(){return y}));var i={};r.r(i),r.d(i,"Point",(function(){return A})),r.d(i,"EWA",(function(){return R}));var o={};r.r(o),r.d(o,"box",(function(){return V})),r.d(o,"cubicBC",(function(){return D}));var a={};r.r(a),r.d(a,"LensException",(function(){return K})),r.d(a,"InvalidArgumentsLength",(function(){return dt})),r.d(a,"UnsolvableMatrix",(function(){return Q})),r.d(a,"InvalidArgument",(function(){return Rt}));var u={};r.r(u),r.d(u,"GaussJordanElimination",(function(){return rt})),r.d(u,"LeastSquares",(function(){return st}));var s={};r.r(s),r.d(s,"gaussJordanElimination",(function(){return u})),r.d(s,"blendColors",(function(){return b})),r.d(s,"perceptibleReciprocal",(function(){return d})),r.d(s,"deg2rad",(function(){return x})),r.d(s,"rad2deg",(function(){return w}));var c={};r.r(c),r.d(c,"Affine",(function(){return Ot})),r.d(c,"Perspective",(function(){return It})),r.d(c,"Arc",(function(){return Vt}));var l={};r.r(l),r.d(l,"Filter",(function(){return L})),r.d(l,"filterFunctions",(function(){return o}));var h={};r.r(h),r.d(h,"AbstractImage",(function(){return zt})),r.d(h,"Canvas",(function(){return Qt})),r.d(h,"DomImage",(function(){return oe}));var f={};function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(f),r.d(f,"interpolationTrait",(function(){return qt})),r.d(f,"virtualPixelTrait",(function(){return Gt})),r.d(f,"createsBestFitViewportFromApexes",(function(){return pt}));var y=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.image=e,this.mapper=r,this.resampler=n,this.bestFit=!1,this.viewport=null,this.async=!0,this.outputScaling=1}var e,r,n;return e=t,(r=[{key:"distort",value:function(){var t=this;this.resampler.setImage(this.image),this.resampler.setMapper(this.mapper);var e=this.prepareViewport(),r=Math.floor(e.x1),n=Math.floor(e.y1),i=Math.floor(e.x2),o=Math.floor(e.y2),a=this.image.getBlank(e);return this.resampler.scaling=1/this.outputScaling,a instanceof Promise?a.then((function(e){return t.performDistortionAsync(e,r,n,i,o)})):this.async?this.performDistortionAsync(a,r,n,i,o):this.performDistortion(a,r,n,i,o)}},{key:"performDistortion",value:function(t,e,r,n,i){for(var o=r;o<=i;o++)for(var a=e;a<=n;a++)t.setPixelColor(a,o,this.resampler.getResampledColor(a+.5,o+.5));return t}},{key:"performDistortionAsync",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return new Promise((function(e){return setTimeout((function(){return e(t.performDistortion.apply(t,r),0)}))}))}},{key:"prepareViewport",value:function(){var t;return(t=this.viewport?this.viewport.clone():this.bestFit&&this.mapper.hasBestFitViewport?this.mapper.getBestFitViewport(this.image.viewport):this.image.viewport.clone()).scale(this.outputScaling),t}}])&&p(e.prototype,r),n&&p(e,n),t}(),v=1e-12,m=Math.PI/2,g=2*Math.PI;function d(t){var e=t<0?-1:1;return e*t>=v?1/t:e/v}function b(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return null===n&&(n=1-e),t.map((function(t,i){return Math.round(t*e+r[i]*n)}))}function w(t){return 180*t/Math.PI}function x(t){return Math.PI*t/180}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function O(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var A=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.matteColor=[0,0,0,0],this.scaling=1}var e,r,n;return e=t,(r=[{key:"setImage",value:function(t){return this.image=t,this}},{key:"setMapper",value:function(t){return this.mapper=t,this}},{key:"getResampledColor",value:function(t,e){t*=this.scaling,e*=this.scaling;var r=this.mapper.getValidity(t,e,this.scaling);if(r>=0){var n=E(this.mapper.reverseMap(t,e),2),i=n[0],o=n[1],a=this.image.getInterpolatedPixelColor(i,o);return r<1?b(a,this.matteColor,r):a}return this.matteColor.slice()}}])&&O(e.prototype,r),n&&O(e,n),t}(),P={BACKGROUND:1,EDGE:3,MIRROR:4,RANDOM:5,TILE:6,TRANSPARENT:7,BLACK:9,GRAY:10,WHITE:11,HORIZONTAL_TILE:12,VERTICAL_TILE:13,HORIZONTAL_TILE_EDGE:14,VERTICAL_TILE_EDGE:15},M={AVERAGE:1,AVERAGE_9:2,AVERAGE_16:3,BACKGROUND:4,INTEGER:8};function C(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function I(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var k=1024;function j(t,e){return Math.max(0,Math.min(e,t))}function S(t,e,r,n){var i=t*t+e*e,o=t*r+e*n,a=o,u=r*r+n*n,s=t*n-e*r,c=s+s,l=i+u,h=(l+c)*(l-c),f=Math.sqrt(h>0?h:0),p=.5*(l+f),y=.5*(l-f),v=p-i,m=p-u,g=v*v,d=m*m,b=g>=d?o:m,w=g>=d?v:a,x=Math.sqrt(b*b+w*w),E=x>0?b/x:1,O=x>0?w/x:0,A=p<=1?1:Math.sqrt(p),P=y<=1?1:Math.sqrt(y);return[E*A,O*A,-O*P,E*P,A,P]}var R=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resizeFilter=e,this.support=this.resizeFilter.support*this.resizeFilter.blur,this.matteColor=[0,0,0,0],this.weightLookupTable=function(t,e){for(var r=[],n=e*Math.sqrt(1/k),i=0;i<k;i++)r[i]=t.getWeight(Math.sqrt(i)*n);return r}(this.resizeFilter,this.support),this.image=null,this.mapper=null,this.imageViewport=null,this.imageArea=null,this.imageVirtualPixelMethod=null,this.imageAverageColor=null,this.A=0,this.B=0,this.C=0,this.F=0,this.uLimit=0,this.vLimit=0,this.uWidth=0,this.slope=0,this.ellipseIsSetUp=!1,this.limitReached=!1,this.scaling=1}var e,r,n;return e=t,(r=[{key:"getResampledColor",value:function(t,e){t*=this.scaling,e*=this.scaling;var r=this.mapper.getValidity(t,e,this.scaling);if(r>0){var n=I(this.mapper.reverseMap(t,e),2),i=n[0],o=n[1];this.mapper.hasConstantPartialDerivatives?this.setupEllipseOnce.apply(this,C(this.mapper.getPartialDerivatives(t,e))):this.setupEllipse.apply(this,C(this.mapper.getPartialDerivatives(t,e)));var a=this.getWeightedAverage(i,o);return r<1?b(a,r,this.matteColor):a}return this.matteColor.slice()}},{key:"setImage",value:function(t){return this.image=t,this.imageViewport=this.image.viewport,this.imageArea=this.imageViewport.area(),this.imageVirtualPixelMethod=this.image.virtualPixelMethod,this.imageAverageColor=null,this}},{key:"setMapper",value:function(t){if(!t.hasPartialDerivatives)throw new Error("Pixel mapper must have partial derivatives to use this resampler");return this.mapper=t,this.ellipseIsSetUp=!1,this}},{key:"setupEllipseOnce",value:function(){return this.ellipseIsSetUp?this:(this.ellipseIsSetUp=!0,this.setupEllipse.apply(this,arguments))}},{key:"setupEllipse",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return this.limitReached=!1,r=r.map((function(e){return e*t.scaling})),this.initEllipse.apply(this,C(r)).scaleEllipse()}},{key:"initEllipse",value:function(){var t=S.apply(void 0,arguments),e=I(t,6),r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5];return this.A=n*n+o*o,this.B=-2*(r*n+i*o),this.C=r*r+i*i,this.F=a*u,this.F*=this.F,this.limitReached=4*this.A*this.C-this.B*this.B>17976931348623157e292,this}},{key:"scaleEllipse",value:function(){if(!this.limitReached){if(this.F*=this.support*this.support,this.uLimit=Math.sqrt(this.C*this.F/(this.A*this.C-.25*this.B*this.B)),this.vLimit=Math.sqrt(this.A*this.F/(this.A*this.C-.25*this.B*this.B)),this.uWidth=Math.sqrt(this.F/this.A),this.slope=-this.B/(2*this.A),this.uWidth*this.vLimit>4*this.imageArea)return this.limitReached=!0,this;var t=k/this.F;this.A*=t,this.B*=t,this.C*=t}return this}},{key:"getWeightedAverage",value:function(t,e){if(this.doesntNeedResampling(t,e))return this.image.getPixelColor(t,e);if(this.limitReached)switch(this.imageVirtualPixelMethod){case P.EDGE:case P.HORIZONTAL_TILE_EDGE:case P.VERTICAL_TILE_EDGE:return this.image.getInterpolatedPixelColor(t,e,M.AVERAGE);case P.HORIZONTAL_TILE:case P.VERTICAL_TILE:return this.image.getPixelColor(this.imageViewport.x1-1,this.imageViewport.y1-1);default:return this.getImageAverageColor()}for(var r=0,n=0,i=0,o=0,a=0,u=0,s=Math.ceil(e-this.vLimit),c=Math.floor(e+this.vLimit),l=t+(s-e)*this.slope-this.uWidth,h=2*this.uWidth+1,f=2*this.A,p=s;p<c;p++){var y=Math.ceil(l);l+=this.slope;for(var v=y+h,m=y-t,g=p-e,d=(this.A*m+this.B*g)*m+this.C*g*g,b=this.A*(2*m+1)+this.B*g,w=y;w<v;w++){if(d<k){var x=this.weightLookupTable[Math.floor(d)],E=I(this.image.getPixelColor(w,p),4),O=E[0],A=E[1],C=E[2],T=E[3];u+=x*T,r+=x,i+=O*(x*=T/this.image.quantumRange),o+=A*x,a+=C*x,n+=x}d+=b,b+=f}}return n&&r?[j(Math.round(i/n),this.image.quantumRange),j(Math.round(o/n),this.image.quantumRange),j(Math.round(a/n),this.image.quantumRange),j(Math.round(u/r),this.image.quantumRange)]:this.image.getInterpolatedPixelColor(t,e)}},{key:"doesntNeedResampling",value:function(t,e){switch(this.imageVirtualPixelMethod){case P.TRANSPARENT:case P.BACKGROUND:case P.BLACK:case P.WHITE:case P.GRAY:return this.limitReached||this.outOfImageBounds(t,e);case P.EDGE:return t+this.uLimit<this.imageViewport.x1&&e+this.vLimit<this.imageViewport.y1||t+this.uLimit<this.imageViewport.x1&&e-this.vLimit>this.imageViewport.y2||t-this.uLimit>this.imageViewport.x2&&e+this.vLimit<this.imageViewport.y1||t-this.uLimit>this.imageViewport.x2&&e-this.vLimit>this.imageViewport.y2;case P.HORIZONTAL_TILE:return e+this.vLimit<this.imageViewport.y1||e-this.vLimit>this.imageViewport.y2;case P.VERTICAL_TILE:return t+this.uLimit<this.imageViewport.x1||t-this.uLimit>this.imageViewport.x2;default:return!1}}},{key:"getImageAverageColor",value:function(){return null===this.imageAverageColor&&(this.imageAverageColor=this.image.getAverageColor()),this.imageAverageColor.slice()}},{key:"outOfImageBounds",value:function(t,e){return t+this.uLimit<this.imageViewport.x1||t-this.uLimit>this.imageViewport.x2||e+this.vLimit<this.imageViewport.y1||e-this.vLimit>this.imageViewport.y2}}])&&T(e.prototype,r),n&&T(e,n),t}();function _(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var L=function(){function t(e,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.filterFunction=e,this.windowFunction=r,this.support=n,this.scale=i,this.blur=o,this.windowSupport=null!==a?a:n}var e,r,n;return e=t,(r=[{key:"getWeight",value:function(t){var e=t/this.blur;return(e<v?1:this.window(this.scale*e))*this.filter(e)}},{key:"filter",value:function(t){return this.filterFunction(t,this.support,this.windowSupport)}},{key:"window",value:function(t){return this.windowFunction(t,this.support,this.windowSupport)}}])&&_(e.prototype,r),n&&_(e,n),t}();function V(){return function(){return 1}}function D(t,e){var r=(6-2*t)/6,n=(12*t-18+6*e)/6,i=(12-9*t-6*e)/6,o=(8*t+24*e)/6,a=(-12*t-48*e)/6,u=(6*t+30*e)/6,s=(-1*t-6*e)/6;return function(t){return t<1?r+t*(t*(n+t*i)):t<2?o+t*(a+t*(u+t*s)):0}}var B={ROBIDOUX:function(){return new L(D(.3782157550939987,.3108921224530007),(function(){return 1}),2,1.1685777620836932,1)},ROBIDOUX_SHARP:function(){return new L(D(.2620145123990142,.3689927438004929),(function(){return 1}),2,1.105822933719019,1)}},F={bestFit:!1,filter:B.ROBIDOUX,resample:!0,async:!0,outputScaling:1};var N=function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"function"==typeof e?e=e(r,t):n=r||{},n=function(t){(t=Object.assign({},F,t)).supersample&&(t.outputScaling=t.supersample);return t}(n),e.forceBestFit&&(n.bestFit=!0);var i=function t(e){if(e instanceof Promise)return e.then((function(e){return t(e)}));if("sync"in e&&"function"==typeof e.sync)return e.sync();return e}(function(t,e,r,n){var i=new y(t,e,r);i.async=!!n.async,i.bestFit=!!n.bestFit,n.viewport&&(i.viewport=n.viewport);n.outputScaling&&(i.outputScaling=n.outputScaling,n.supersample&&(i.supersample=!0));return i}(t,e,function(t,e,r){var n;n=r.resampler?r.resampler:r.resample?new R(function(t){if("function"==typeof t.filter)return t.filter();return t.filter}(r)):new A;r.matteColor&&(n.matteColor=r.matteColor.slice());return n}(0,0,n),n).distort());return n.supersample&&1!==n.supersample?function t(e,r){if(e instanceof Promise)return e.then((function(e){return t(e,r)}));if("scale"in e&&"function"==typeof e.scale)return e.scale(r);console.warn("Method 'scale()' not found in image object. No scaling performed.");return e}(i,1/n.supersample):i};function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function U(t){var e="function"==typeof Map?new Map:void 0;return(U=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return H(t,arguments,z(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),W(n,t)})(t)}function H(t,e,r){return(H=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&W(i,r.prototype),i}).apply(null,arguments)}function W(t,e){return(W=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){function e(t){var r,n,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,(r=!(i=z(e).call(this,t))||"object"!==G(i)&&"function"!=typeof i?q(n):i).name=r.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(q(r),r.constructor):r.stack=new Error(t).stack,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&W(t,e)}(e,t),e}(U(Error));function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Q=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),J(this,X(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(e,t),e}(K);function $(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tt(t,e,r,n,i){t[e][r]!==t[n][i]&&(t[e][r]+=t[n][i],t[n][i]=t[e][r]-t[n][i],t[e][r]-=t[n][i])}function et(){throw new Q("Can't solve given matrix using Gauss-Jordan method")}var rt=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.solved=!1,this.matrix=e.map((function(t){return t.slice()})),this.vectors=r.map((function(t){return t.slice()}))}var e,r,n;return e=t,(r=[{key:"solve",value:function(){if(this.solved)return this;this.validate();for(var t=this.matrix,e=this.vectors,r=t.length,n=e.length,i=new Array(r).fill(0),o=new Array(r).fill(0),a=new Array(r).fill(0),u=0,s=0,c=0;c<r;c++){for(var l=0,h=0;h<r;h++)if(1!==a[h])for(var f=0;f<r;f++)0!==a[f]?a[f]>1&&et():Math.abs(t[h][f])>=l&&(l=Math.abs(t[h][f]),s=h,u=f);if(a[u]++,s!==u){for(var p=0;p<r;p++)tt(t,s,p,u,p);for(var y=0;y<n;y++)tt(e,y,s,y,u)}o[c]=s,i[c]=u,0===t[u][u]&&et();var v=d(t[u][u]);t[u][u]=1;for(var m=0;m<r;m++)t[u][m]*=v;for(var g=0;g<n;g++)e[g][u]*=v;for(var b=0;b<r;b++)if(b!==u){var w=t[b][u];t[b][u]=0;for(var x=0;x<r;x++)t[b][x]-=w*t[u][x];for(var E=0;E<n;E++)e[E][b]-=w*e[E][u]}}for(var O=r-1;O>=0;O--)if(i[O]!==o[O])for(var A=0;A<r;A++)tt(t,A,o[O],A,i[O]);return this.solved=!0,this}},{key:"getVectors",value:function(){return this.vectors.map((function(t){return t.slice()}))}},{key:"validate",value:function(){var t=this.matrix.length;return this.matrix.forEach((function(e){if(e.length!==t)throw new Error("Matrix must be square")})),this.vectors.forEach((function(e){if(e.length!==t)throw new Error("Vectors must be the same length as matrix rank")})),this}}])&&$(e.prototype,r),n&&$(e,n),t}();function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ot(t,e){return!e||"object"!==nt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function at(t){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ut(t,e){return(ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var st=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n=[],i=[],o=0;o<t;o++)n.push(new Array(t).fill(0));for(var a=0;a<r;a++)i.push(new Array(t).fill(0));return ot(this,at(e).call(this,n,i))}var r,n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}(e,t),r=e,(n=[{key:"addTerms",value:function(t,e){for(var r=this.matrix.length,n=0;n<r;n++){for(var i=0;i<r;i++)this.matrix[i][n]+=t[i]*t[n];for(var o=0;o<this.vectors.length;o++)this.vectors[o][n]+=e[o]*t[n]}return this}}])&&it(r.prototype,n),i&&it(r,i),e}(rt);function ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var lt=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x1=e,this.y1=r,this.x2=n,this.y2=i}var e,r,n;return e=t,(r=[{key:"width",value:function(){return this.x2-this.x1+1}},{key:"height",value:function(){return this.y2-this.y1+1}},{key:"area",value:function(){return this.width()*this.height()}},{key:"contains",value:function(t,e){return t>=this.x1&&t<=this.x2&&e>=this.y1&&e<=this.y2}},{key:"expand",value:function(t,e){return this.x1=Math.min(this.x1,t),this.x2=Math.max(this.x2,t),this.y1=Math.min(this.y1,e),this.y2=Math.max(this.y2,e),this}},{key:"clone",value:function(){return new this.constructor(this.x1,this.y1,this.x2,this.y2)}},{key:"fixBounds",value:function(){return this.x1=Math.floor(this.x1-.5),this.y1=Math.floor(this.y1-.5),this.x2=Math.ceil(this.x2-.5),this.y2=Math.ceil(this.y2-.5),this}},{key:"scale",value:function(t){return this.x1=Math.round(this.x1*t),this.y1=Math.round(this.y1*t),this.x2=Math.round(this.x2*t),this.y2=Math.round(this.y2*t),this}},{key:"reset",value:function(){var t=this.width(),e=this.height();return this.x1=0,this.y1=0,this.x2=this.x1+t-1,this.y2=this.y1+e-1,this}}])&&ct(e.prototype,r),n&&ct(e,n),t}();function ht(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ft(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var pt={getBestFitViewport:function(t){var e=this,r=t.x1,n=t.y1,i=t.x2+1,o=t.y2+1,a=ft(this.forwardMap(r,n),2),u=a[0],s=a[1],c=new lt(u,s,u,s);return[[i,n],[i,o],[r,o]].forEach((function(t){return c.expand.apply(c,ht(e.forwardMap.apply(e,ht(t))))})),c.fixBounds(),c}};function yt(t){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(t,e){return!e||"object"!==yt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function mt(t){return(mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gt(t,e){return(gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var dt=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),vt(this,mt(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gt(t,e)}(e,t),e}(K);function bt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xt(t,e,r){return[r[0]*t+r[1]*e+r[2],r[3]*t+r[4]*e+r[5]]}var Et=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.matrix=e,this.forwardMatrix=this.constructor.invertAffineMatrix(e),this.hasPartialDerivatives=!0,this.hasConstantPartialDerivatives=!0,this.hasBestFitViewport=!0}var e,r,n;return e=t,n=[{key:"fromControlPoints",value:function(e){if(e.length%4!=0)throw new dt("Number of arguments must be multiple of 4 and at least 4 arguments (1 control point) expected. ".concat(e.length," arguments given."));if(4===e.length)return new t([1,0,e[0]-e[2],0,1,e[1]-e[3]]);for(var r=new st(3,2),n=0;n<e.length;n+=4){var i=bt(e.slice(n,n+4),4),o=i[0],a=i[1],u=i[2],s=i[3];r.addTerms([u,s,1],[o,a])}8===e.length&&r.addTerms([e[2]-(e[7]-e[3]),e[3]+(e[6]-e[2]),1],[e[0]-e[5]+e[1],e[1]+e[4]-e[0]]);var c=r.solve().getVectors();return new t(c[0].concat(c[1]))}},{key:"fromForwardMatrix",value:function(e){return new t(this.invertAffineMatrix(e))}},{key:"invertAffineMatrix",value:function(t){var e=d(t[0]*t[4]-t[1]*t[3]);return[e*t[4],e*-t[1],e*(t[1]*t[5]-t[2]*t[4]),e*-t[3],e*t[0],e*(t[2]*t[3]-t[0]*t[5])]}}],(r=[{key:"reverseMap",value:function(t,e){return xt(t,e,this.matrix)}},{key:"getValidity",value:function(t,e){return 1}},{key:"getPartialDerivatives",value:function(t,e){return[this.matrix[0],this.matrix[1],this.matrix[3],this.matrix[4]]}},{key:"forwardMap",value:function(t,e){return xt(t,e,this.forwardMatrix)}}])&&wt(e.prototype,r),n&&wt(e,n),t}();Object.assign(Et.prototype,pt);var Ot=Et;function At(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,e,r){var n=r[0]*t+r[1]*e+r[2],i=r[3]*t+r[4]*e+r[5],o=r[6]*t+r[7]*e+1;return[n/o,i/o]}var Ct=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.matrix=e,this.denominator=r,this.forwardMatrix=this.constructor.invertPerspectiveMatrix(e),this.hasPartialDerivatives=!0,this.hasConstantPartialDerivatives=!1,this.hasBestFitViewport=!0}var e,r,n;return e=t,n=[{key:"fromControlPoints",value:function(e){if(e.length<16||e.length%4!=0)throw new dt("Number of arguments must be multiple of 4 and at least 16 arguments (4 control points) expected. ".concat(e.length," arguments given."));for(var r=new st(8,1),n=0;n<e.length;n+=4){var i=At(e.slice(n,n+4),4),o=i[0],a=i[1],u=i[2],s=i[3];r.addTerms([u,s,1,0,0,0,-u*o,-s*o],[o]).addTerms([0,0,0,u,s,1,-u*a,-s*a],[a])}var c=r.solve().getVectors()[0];return new t(c,c[6]*e[2]+c[7]*e[3]+1<0?-1:1)}},{key:"fromForwardMatrix",value:function(e){var r=this.invertPerspectiveMatrix(e);return new t(r,r[6]*e[2]+r[7]*e[5]+1<0?-1:1)}},{key:"invertPerspectiveMatrix",value:function(t){var e=d(t[0]*t[4]-t[3]*t[1]);return[e*(t[4]-t[7]*t[5]),e*(t[7]*t[2]-t[1]),e*(t[1]*t[5]-t[4]*t[2]),e*(t[6]*t[5]-t[3]),e*(t[0]-t[6]*t[2]),e*(t[3]*t[2]-t[0]*t[5]),e*(t[3]*t[7]-t[6]*t[4]),e*(t[6]*t[1]-t[0]*t[7])]}}],(r=[{key:"reverseMap",value:function(t,e){return Mt(t,e,this.matrix)}},{key:"getValidity",value:function(t,e,r){var n=this.matrix[6]*t+this.matrix[7]*e+1,i=n*this.denominator<0?0:1,o=2*Math.abs(n),a=Math.abs(this.matrix[6]),u=Math.abs(this.matrix[7]);return a>u?o<a&&(i=.5-this.denominator*n/(this.matrix[6]*r)):o<u&&(i=.5-this.denominator*n/(this.matrix[7]*r)),i}},{key:"getPartialDerivatives",value:function(t,e){var r=this.matrix[0]*t+this.matrix[1]*e+this.matrix[2],n=this.matrix[3]*t+this.matrix[4]*e+this.matrix[5],i=this.matrix[6]*t+this.matrix[7]*e+1,o=Math.pow(1/i,2);return[(i*this.matrix[0]-r*this.matrix[6])*o,(i*this.matrix[1]-r*this.matrix[7])*o,(i*this.matrix[3]-n*this.matrix[6])*o,(i*this.matrix[4]-n*this.matrix[7])*o]}},{key:"forwardMap",value:function(t,e){return Mt(t,e,this.forwardMatrix)}}])&&Pt(e.prototype,r),n&&Pt(e,n),t}();Object.assign(Ct.prototype,pt);var It=Ct;function Tt(t){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kt(t,e){return!e||"object"!==Tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function St(t,e){return(St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Rt=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),kt(this,jt(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&St(t,e)}(e,t),e}(K);function _t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Vt=function(){function t(e,r,n,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewport=e,this.c0=r,this.c1=n,this.c2=i,this.c3=o,this.c4=a,this.angleToWidth=g*this.viewport.width()/this.c1,this.radiusToHeight=this.viewport.height()/this.c3,this.hasPartialDerivatives=!0,this.hasConstantPartialDerivatives=!1,this.hasBestFitViewport=!0,this.forceBestFit=!0}var e,r,n;return e=t,n=[{key:"fromArguments",value:function(e,r){if(r.length>=1&&r[0]<v)throw new Rt("Angle too small");if(r.length>=3&&r[2]<v)throw new Rt("Outer radius too small");var n,i,o,a,u;return n=-m,i=r.length>=1?x(r[0]):m,r.length>=2&&(n+=x(r[1])),n/=g,n-=Math.round(n),n*=g,a=e.height()-1,o=e.width()/i+a/2,r.length>=3&&(r.length>=4?a=r[2]-r[3]:a*=r[2]/o,o=r[2]),u=(e.width()-1)/2,new t(e,n,i,o,a,u)}}],(r=[{key:"reverseMap",value:function(t,e){var r=_t(this.getUV(t,e),2),n=r[0],i=r[1];return[n=n*this.angleToWidth+this.c4+this.viewport.x1+.5,i=(this.c2-i)*this.radiusToHeight+this.viewport.y1]}},{key:"getValidity",value:function(t,e){return 1}},{key:"getPartialDerivatives",value:function(t,e){var r=_t(this.getUV(t,e),2),n=(r[0],r[1]);return n>v?[this.angleToWidth/(g*n),0,0,this.radiusToHeight]:[2*this.viewport.width(),0,0,this.radiusToHeight]}},{key:"getBestFitViewport",value:function(t){var e=this.c0-this.c1/2,r=Math.cos(e),n=Math.sin(e),i=this.c2*r,o=this.c2*n,a=new lt(i,o,i,o);for(i=(this.c2-this.c3)*r,o=(this.c2-this.c3)*n,a.expand(i,o),e=this.c0+this.c1/2,r=Math.cos(e),n=Math.sin(e),i=this.c2*r,o=this.c2*n,a.expand(i,o),i=(this.c2-this.c3)*r,o=(this.c2-this.c3)*n,a.expand(i,o),e=Math.ceil((this.c0-this.c1/2)/m)*m;e<this.c0+this.c1/2;e+=m)r=Math.cos(e),n=Math.sin(e),i=this.c2*r,o=this.c2*n,a.expand(i,o);return a.fixBounds(),a}},{key:"getUV",value:function(t,e){var r;return r=(Math.atan2(e,t)-this.c0)/g,[r-=Math.round(r),Math.hypot(t,e)]}}])&&Lt(e.prototype,r),n&&Lt(e,n),t}();function Dt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bt(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ft(t,e,r,n){return[Math.max(0,Math.min(r-1,t)),Math.max(0,Math.min(n-1,e))]}function Nt(t,e,r,n){var i=t%r,o=e%n;return[i<0?r+i:i,o<0?n+o:o]}var Gt={getVirtualPixelColor:function(t,e,r){switch(r){case P.BACKGROUND:return this.backgroundColor.slice();case P.EDGE:return this.getImagePixelColor.apply(this,Bt(Ft(t,e,this.width,this.height)));case P.MIRROR:var n=Dt(Nt(t,e,2*this.width,2*this.height),2),i=n[0],o=n[1];return i>this.width-1&&(i=this.width-(i-this.width)-1),o>this.height-1&&(o=this.height-(o-this.height)-1),this.getImagePixelColor(i,o);case P.TILE:return this.getImagePixelColor.apply(this,Bt(Nt(t,e,this.width,this.height)));case P.TRANSPARENT:default:return[0,0,0,0];case P.BLACK:return[0,0,0,this.quantumRange];case P.WHITE:return new Array(4).fill(this.quantumRange);case P.GRAY:return new Array(3).fill(Math.round(this.quantumRange/2)).concat([this.quantumRange]);case P.HORIZONTAL_TILE:case P.HORIZONTAL_TILE_EDGE:return e<0||e>=this.height?r===P.HORIZONTAL_TILE?this.backgroundColor.slice():this.getImagePixelColor.apply(this,Bt(Ft(t,e,this.width,this.height))):this.getImagePixelColor.apply(this,Bt(Nt(t,e,this.width,this.height)));case P.VERTICAL_TILE:case P.VERTICAL_TILE_EDGE:return t<0||e>=this.width?r===P.VERTICAL_TILE?this.backgroundColor.slice():this.getImagePixelColor.apply(this,Bt(Ft(t,e,this.width,this.height))):this.getImagePixelColor.apply(this,Bt(Nt(t,e,this.width,this.height)));case P.RANDOM:return this.getImagePixelColor(Math.floor(Math.random()*this.width),Math.floor(Math.random()*this.height))}}},qt={getInterpolatedPixelColor:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.interpolationMethod;switch(r){case M.AVERAGE:return this.interpolateAverage(t,e,2);case M.AVERAGE_9:return this.interpolateAverage(t,e,3);case M.AVERAGE_16:return this.interpolateAverage(t,e,4);case M.BACKGROUND:return this.backgroundColor.slice();case M.INTEGER:default:return this.getPixelColor(Math.floor(t),Math.floor(e))}},interpolateAverage:function(t,e){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;switch(i){case 2:r=Math.floor(t),n=Math.floor(e);break;case 3:r=Math.floor(t+.5)-1,n=Math.floor(e+.5)-1;break;case 4:r=Math.floor(t)-1,n=Math.floor(e)-1;break;default:throw new Error("Param 'count' must be integer between 2 and 4.")}for(var o=r+i,a=n+i,u=[0,0,0,0],s=n;s<a;s++)for(var c=r;c<o;c++)this.getPixelColor(t,e).forEach((function(t,e){return u[e]+=t}));var l=1/(i*i);return u.map((function(t){return Math.round(t*l)}))}};function Ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ht(t){throw new Error("".concat(t,"() is abstract method and must be implemented by child class"))}var Wt=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=e,this.height=r,this.viewport=new lt(0,0,this.width-1,this.height-1),this.backgroundColor=[0,0,0,0],this.virtualPixelMethod=P.TRANSPARENT,this.quantumRange=255,this.interpolationMethod=M.INTEGER}var e,r,n;return e=t,(r=[{key:"getPixelColor",value:function(t,e){return t=Math.floor(t-this.viewport.x1),e=Math.floor(e-this.viewport.y1),t>=0&&t<this.width&&e>=0&&e<this.height?this.getImagePixelColor(t,e):this.getVirtualPixelColor(t,e,this.virtualPixelMethod)}},{key:"setPixelColor",value:function(t,e,r){if(t=Math.floor(t-this.viewport.x1),e=Math.floor(e-this.viewport.y1),t>=0&&t<this.width&&e>=0&&e<this.height)return this.setImagePixelColor(t,e,r),this;throw new Error("Given coords (".concat(t,", ").concat(e,") is out of image bounds"))}},{key:"getBlank",value:function(t){var e=this.prepareBlank(t.width(),t.height());return e instanceof Promise?e.then((function(e){return e.viewport=t,e})):(e.viewport=t,e)}},{key:"scale",value:function(t){var e=this.viewport.clone();e.scale(t);var r=this.resize(e.width(),e.height());return r instanceof Promise?r.then((function(){return r.viewport=e,r})):(r.viewport=e,r)}},{key:"sync",value:function(){return this}},{key:"getImagePixelColor",value:function(t,e){Ht("getImagePixelColor")}},{key:"setImagePixelColor",value:function(t,e,r){Ht("setImagePixelColor")}},{key:"prepareBlank",value:function(t,e){Ht("prepareBlank")}},{key:"getAverageColor",value:function(){Ht("getAverageColor")}},{key:"resize",value:function(t,e){Ht("resize")}}])&&Ut(e.prototype,r),n&&Ut(e,n),t}();Object.assign(Wt.prototype,Gt),Object.assign(Wt.prototype,qt);var zt=Wt;function Kt(t){return(Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Jt(t,e){return!e||"object"!==Kt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xt(t){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Yt(t,e){return(Yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Qt=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Jt(this,Xt(e).call(this,t.width,t.height))).canvas=t,r.imageData=t.getContext("2d").getImageData(0,0,t.width,t.height),r.data=r.imageData.data,r}var r,n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yt(t,e)}(e,t),r=e,(n=[{key:"getImagePixelColor",value:function(t,e){var r=4*(e*this.width+t);return Array.prototype.slice.call(this.data,r,r+4)}},{key:"setImagePixelColor",value:function(t,e,r){var n=this,i=4*(e*this.width+t);r.forEach((function(t,e){return n.data[i+e]=t}))}},{key:"prepareBlank",value:function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,new this.constructor(r)}},{key:"sync",value:function(){return this.canvas.getContext("2d").putImageData(this.imageData,0,0),this}},{key:"getAverageColor",value:function(){var t=document.createElement("canvas");return t.width=1,t.height=1,t.getContext("2d").drawImage(this.canvas,0,0,this.width,this.height,0,0,1,1),Array.prototype.slice.call(t.getContext("2d").getImageData(0,0,1,1).data)}},{key:"resize",value:function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d").drawImage(this.canvas,0,0,this.width,this.height,0,0,t,e),new this.constructor(r)}}])&&Zt(r.prototype,n),i&&Zt(r,i),e}(zt);function $t(t){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function te(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ee(t,e){return!e||"object"!==$t(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function re(t,e,r){return(re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ne(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function ne(t){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ie(t,e){return(ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var oe=function(t){function e(t){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),(r=ee(this,ne(e).call(this,n))).image=t,r}var r,n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ie(t,e)}(e,t),r=e,(n=[{key:"prepareBlank",value:function(t,e){return new this.constructor(new Image(t,e))}},{key:"sync",value:function(){var t=this;return re(ne(e.prototype),"sync",this).call(this),new Promise((function(e){t.image.onload=function(){return e(t)},t.image.src=t.canvas.toDataURL()}))}},{key:"resize",value:function(t,e){var r=this;return this.sync().then((function(){return new Promise((function(n){var i=document.createElement("canvas");i.width=t,i.height=e,i.getContext("2d").drawImage(r.image,0,0,r.width,r.height,0,0,t,e);var o=new Image(t,e);o.onload=function(){var t=new r.constructor(o);n(t)},o.src=i.toDataURL()}))}))}}])&&te(r.prototype,n),i&&te(r,i),e}(Qt);function ae(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ue={AFFINE:function(t){return Ot.fromControlPoints(t)},AFFINE_PROJECTION:function(t){var e=ae(t,6),r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5];return Ot.fromForwardMatrix([r,i,a,n,o,u])},PERSPECTIVE:function(t){return t.length<16?(console.warn("Perspective distortion requires at least 4 controls points mapping (u, v) -> (x, y). Affine distortion will be used."),Ot.fromControlPoints(t)):It.fromControlPoints(t)},PERSPECTIVE_PROJECTION:function(t){return It.fromForwardMatrix(t)},ARC:function(t,e){return Vt.fromArguments(e.viewport,t)}};function se(t,e){ue[t]=e}function ce(t){delete ue[t]}var le=ue;r.d(e,"VERSION",(function(){return he})),r.d(e,"distort",(function(){return N})),r.d(e,"distorter",(function(){return n})),r.d(e,"distortion",(function(){return c})),r.d(e,"exception",(function(){return a})),r.d(e,"filter",(function(){return l})),r.d(e,"filterPresets",(function(){return B})),r.d(e,"image",(function(){return h})),r.d(e,"mixins",(function(){return f})),r.d(e,"resampler",(function(){return i})),r.d(e,"util",(function(){return s})),r.d(e,"interpolation",(function(){return M})),r.d(e,"vpx",(function(){return P})),r.d(e,"Viewport",(function(){return lt})),r.d(e,"distorts",(function(){return le})),r.d(e,"registerDistortionResolver",(function(){return se})),r.d(e,"unregisterDistortionResolver",(function(){return ce})),r.d(e,"EPSILON",(function(){return v})),r.d(e,"MAXIMUM_VALUE",(function(){return 17976931348623157e292})),r.d(e,"M_PI2",(function(){return m})),r.d(e,"M_2PI",(function(){return g}));var he="0.1.0"}])}));
//# sourceMappingURL=lens.min.js.map